<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>6å­”æ¿ç»†èƒå…‹éš†ç²¾å‡†è®¡æ•°å™¨</title>
    <script async src="https://docs.opencv.org/4.5.4/opencv.js" type="text/javascript"></script>
    <style>
        :root { --accent: #007bff; }
        body { font-family: system-ui; background: #f4f4f9; padding: 20px; line-height: 1.6; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 20px; color: #333; }
        .setup-box { border: 2px dashed #ddd; padding: 20px; text-align: center; border-radius: 10px; margin-bottom: 20px; }
        .main-layout { display: grid; grid-template-columns: 280px 1fr; gap: 20px; }
        .sidebar { background: #f8f9fa; padding: 15px; border-radius: 10px; }
        canvas { width: 100%; border-radius: 5px; background: #eee; margin-top: 10px; }
        .label { font-weight: bold; font-size: 0.9em; display: block; margin-top: 15px; }
        .status-ready { color: green; font-weight: bold; }
        .result-badge { font-size: 2em; color: var(--accent); display: block; margin: 10px 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ”¬ 6å­”æ¿å…‹éš†è®¡æ•° - è‡ªåŠ¨è¾¹ç¼˜å‰”é™¤ç‰ˆ</h2>
        <p id="info">æ­£åœ¨åˆå§‹åŒ–ç®—æ³•åº“...</p>
    </div>

    <div class="setup-box" id="dropZone">
        <input type="file" id="fileInput" accept="image/*" style="display:none">
        <button onclick="document.getElementById('fileInput').click()" style="padding:10px 20px; cursor:pointer;">é€‰æ‹© 6 å­”æ¿ç…§ç‰‡</button>
        <p style="font-size: 0.8em; color: #666;">ç®—æ³•ä¼šè‡ªåŠ¨å¯»æ‰¾åœ†å½¢å­”ä½å¹¶å‰”é™¤å¤–æ¡†å¹²æ‰°</p>
    </div>

    <div class="main-layout">
        <div class="sidebar">
            <span class="label">æ€»å…‹éš†è®¡æ•°</span>
            <span id="totalCount" class="result-badge">0</span>
            
            <hr>
            <span class="label">å­”å†…çµæ•åº¦ (é˜ˆå€¼): <span id="v1">120</span></span>
            <input type="range" id="threshold" min="0" max="255" value="120">
            
            <span class="label">æœ€å°å…‹éš†å°ºå¯¸: <span id="v2">30</span></span>
            <input type="range" id="minArea" min="5" max="500" value="30">

            <span class="label">è¾¹ç¼˜å®‰å…¨é—´è·: <span id="v3">10</span>px</span>
            <input type="range" id="margin" min="0" max="50" value="10">
            
            <p style="font-size: 0.75em; color: #888; margin-top: 20px;">æç¤ºï¼šè‹¥æ— æ³•è‡ªåŠ¨è¯†åˆ«å­”ï¼Œè¯·å°è¯•æé«˜å›¾ç‰‡å¯¹æ¯”åº¦æˆ–æ‰‹åŠ¨å¾®è°ƒå‚æ•°ã€‚</p>
        </div>

        <div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <span class="label">1. å­”ä½è¯†åˆ« (ROI Detection)</span>
                    <canvas id="canvasRoi"></canvas>
                </div>
                <div>
                    <span class="label">2. å…‹éš†ç»Ÿè®¡ç»“æœ</span>
                    <canvas id="canvasOutput"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let rawMat = null;

// OpenCV åŠ è½½ç›‘å¬
function onOpenCvReady() {
    document.
